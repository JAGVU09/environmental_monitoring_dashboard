---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyr)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(stringr)
```


```{r}
micro<-read_excel('./data/eMIC Notebook - Berg.xlsx') %>% 
  fill(`MID Number`, .direction = "down") %>% 
  fill(`Colony Morphology`, .direction = "down") %>% 
  fill(`Performance Date`, .direction = "down") %>% 
  pivot_longer(cols = starts_with('Site Location'), values_drop_na = TRUE) %>% 
  dplyr::select(`Performance Date`, `MID Number`, `Colony Morphology`, value) %>% 
  rename(date = `Performance Date`, ID = `MID Number`, sample_site = value) %>% 
  mutate(date = parse_date_time(`date`,orders = 'd%B%Y%')) %>% 
  mutate(Q = quarter(`date`, with_year = TRUE))
```
Possible variation on a sample site name (Human Data Entry Error)
311-5: Air 5
311:5: Air 5
311-5:Air 5
311-5 
311-5 Air 5
311-5:Air5
311: 5Air 5
311-5 :Air 5
311-5Air 5
311-5: air 5
311-5Air5
Construct a Regex that matches all of these and a match that converts to 311-5

```{r}
micro$sample_site<-micro$sample_site %>% str_replace('\\d+[:|-]\\s?\\d+:?\\s?:?[A-Za-z]+\\s?\\d+', '\\d+-\\d+') %>% str_replace('-\\s+', '-') 
```

```{r}
micro
```

```{r}
#Count ID grouped by site and add in Time component with date column.
micro %>% 
  group_by(sample_site) %>% 
  summarise(tot_ids = n()) %>% 
  ungroup() %>% 
  arrange(desc(tot_ids))
```

```{r}
micro %>% 
  group_by(sample_site, Q) %>% 
  summarise(tot_ids = n()) %>% 
  ungroup() %>% 
  arrange(desc(tot_ids))
```
```{r}
micro$sample_site %>% str_replace('\\d+[:|-]\\s?\\d+:?\\s?:?[A-Za-z]+\\s?\\d+', '\\d+-\\d+') %>% str_replace('-\\s+', '-') %>% n_distinct()
```
```{r}
micro$date %>% is.na()

```




