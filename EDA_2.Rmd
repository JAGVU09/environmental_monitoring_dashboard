---
title: "EDA_2"
author: "James Gilbert"
date: '2022-06-10'
output: html_document
---

```{r}
library(tidyr)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(stringr)
library(ggplot2)
```

```{r}
micro<-read_csv('./data/micro_em.csv')
```

```{r}
micro$sample_site %>% 
  unique() %>% 
  tibble() %>% 
  write_csv('./data/sample_sites.csv')
```

```{r}
micro$sample_site %>% unique()
```

```{r}
weeks <-micro %>% 
  mutate(Week = week(`date`)) %>% 
  group_by(sample_site, Week) %>% 
  summarise(tot_ids = n()) %>% 
  ungroup() %>% 
  arrange(desc(tot_ids))
```

```{r}

df <- weeks %>% filter(str_detect(sample_site, "^302"))

t<-ggplot(df, aes(x = Week, y = tot_ids, color = sample_site)) +
  geom_col()

t + facet_wrap(vars(sample_site))
```


```{r}
quarters<-micro %>% 
  group_by(sample_site, Q) %>% 
  summarise(tot_ids = n()) %>% 
  ungroup() %>% 
  arrange(desc(tot_ids))
```

```{r}
dates<-micro %>% 
  group_by(sample_site, date) %>% 
  summarise(tot_ids = n()) %>% 
  ungroup() %>% 
  arrange(desc(tot_ids))
```

```{r}
df <- quarters %>% filter(str_detect(sample_site, "^302"))

t<-ggplot(df, aes(x = Q, y = tot_ids, color = sample_site)) +
  geom_line()

t + facet_wrap(vars(sample_site))
```

```{r}
df <- dates %>% filter(str_detect(sample_site, "^308"))

t<-ggplot(df, aes(x = date, y = tot_ids, color = sample_site)) +
  geom_line()

t + facet_wrap(vars(sample_site))
```



```{r}
weeks %>%
  filter(str_detect(sample_site, '302-1\\b')) %>% 
  ggplot(aes(x = Week, y = tot_ids)) +
  geom_line(show.legend = FALSE)+
  geom_hline(yintercept = c(75, 50), linetype = c('solid','dashed'), color = c('red', 'orange'))
```

```{r}
df <- weeks %>%
  filter(str_detect(sample_site, '302-2\\b'))

t_2<-ggplot(df, aes(x = Week, y = tot_ids)) +
  geom_line(show.legend = FALSE)

graph2<-t_2 + geom_hline(yintercept = c(100, 75), linetype = c('solid','dashed'), color = c('red', 'orange'))

graph2
```

```{r}
df <- weeks %>%
  filter(str_detect(sample_site, '302-7\\b'))

t_3<-ggplot(df, aes(x = Week, y = tot_ids)) +
  geom_line(show.legend = FALSE)

graph3<-t_3 +geom_hline(yintercept = c(100, 75), linetype = c('solid','dashed'), color = c('red', 'orange'))

graph3
```



```{r}
df_week <- weeks %>%
  filter(str_detect(sample_site, '305-1\\b'))

t_week<-ggplot(df_week, aes(x = Week, y = tot_ids)) +
  geom_line()
 
graph4<-t_week + geom_hline(yintercept = c(100, 75), linetype = c('solid','dashed'), color = c('red', 'orange'))

```


```{r}
arima(dates$tot_ids)
```

